<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Por un mill√≥n de d√≥lares</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background: linear-gradient(180deg,#1c1f26,#283048,#3a6073);
  color:#fff;
}

header{
  padding:30px 15px;
  text-align:center;
}

h1{
  margin:0;
  font-size:32px;
}

.subtitle{
  margin-top:10px;
  color:#dcdcdc;
}

.card{
  max-width:1000px;
  margin:0 auto 40px;
  background:rgba(0,0,0,0.35);
  backdrop-filter:blur(10px);
  border-radius:25px;
  padding:25px;
  box-shadow:0 25px 50px rgba(0,0,0,0.5);
}

#map{
  height:60vh;
  border-radius:20px;
  margin-top:20px;
}

.controls{
  text-align:center;
  margin:20px 0;
}

button{
  padding:15px 40px;
  font-size:17px;
  font-weight:bold;
  border:none;
  border-radius:30px;
  cursor:pointer;
  margin:10px;
}

.btn-main{
  background:linear-gradient(135deg,#ffd700,#ffae00);
  color:#000;
}

.btn-yes{
  background:#00c853;
  color:#fff;
}

.btn-no{
  background:#d50000;
  color:#fff;
}

#mensaje{
  text-align:center;
  font-size:19px;
  margin-top:15px;
  min-height:30px;
}

#stats{
  margin-top:25px;
  padding-top:15px;
  border-top:1px solid rgba(255,255,255,0.2);
  text-align:center;
  font-size:16px;
}
.reset {
  background: #3498db;
  color: white;
}
</style>
</head>

<body>

<header>
  <h1>üíµ Por un mill√≥n de d√≥lares</h1>
  <div class="subtitle">
    Oprimes el bot√≥n‚Ä¶ el destino decide d√≥nde caes üåç
  </div>
</header>

<div class="card">

  <div class="controls">
    <button class="btn-main" onclick="jugar()">POR EL MILLON</button>
    <button class="reset" onclick="reiniciar()">REINICIAR CONTEO</button>
  </div>

  <div id="mensaje"></div>

  <div class="controls" id="decision" style="display:none">
    <button class="btn-yes" onclick="aceptar()">ACEPTO EL MILL√ìN üíµ</button>
    <button class="btn-no" onclick="rechazar()">RECHAZO ‚ùå</button>
  </div>

  <div id="map"></div>

  <div id="stats">
    <h3>üìä Resultados (en este dispositivo)</h3>
    üë• Participantes: <b><span id="total">0</span></b><br>
    üíµ Aceptaron: <b><span id="aceptaron">0</span></b><br>
    ‚ùå Rechazaron: <b><span id="rechazaron">0</span></b><br>
    üìà Aceptan el mill√≥n: <b><span id="porcentaje">0</span>%</b>
  </div>

</div>

<audio id="sonido">
  <source src="https://www.soundjay.com/buttons/sounds/button-30.mp3">
</audio>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// ================= MAPA =================
const map = L.map('map').setView([20,0],2);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'¬© OpenStreetMap'
}).addTo(map);

// Colores para pa√≠ses
function colorAleatorio(){
  return `hsl(${Math.random()*360},60%,65%)`;
}

// Capa pa√≠ses
fetch('https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json')
.then(res=>res.json())
.then(data=>{
  L.geoJSON(data,{
    style:()=>({
      fillColor:colorAleatorio(),
      fillOpacity:0.6,
      color:'#222',
      weight:1
    })
  }).addTo(map);
});

let marcador;

// ================= JUEGO =================
function jugar(){
  document.getElementById("sonido").play();
  document.getElementById("decision").style.display="none";
  document.getElementById("mensaje").innerText="‚è≥ El destino est√° decidiendo...";

  setTimeout(generarLugar,1500);
}

async function generarLugar(){
  const lat=(Math.random()*180-90).toFixed(5);
  const lon=(Math.random()*360-180).toFixed(5);

  if(marcador) map.removeLayer(marcador);

  marcador=L.marker([lat,lon]).addTo(map);
  map.setView([lat,lon],5);

  try{
    const res=await fetch(
      `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`
    );
    const data=await res.json();

    if(data.address && data.address.country){
      document.getElementById("mensaje").innerText=
        `üåç Ca√≠ste en ${data.address.country}. ¬øAceptas el mill√≥n?`;
    }else{
      document.getElementById("mensaje").innerText=
        `üåä Ca√≠ste en medio del oc√©ano‚Ä¶ ¬øAceptas el mill√≥n?`;
    }
  }catch{
    document.getElementById("mensaje").innerText=
      "El destino decidi√≥‚Ä¶ ¬øAceptas el mill√≥n?";
  }

  document.getElementById("decision").style.display="block";
}

// ================= CONTADOR =================
function iniciarContador(){
  if(!localStorage.getItem("total")){
    localStorage.setItem("total",0);
    localStorage.setItem("aceptaron",0);
    localStorage.setItem("rechazaron",0);
  }
  actualizarStats();
}

function actualizarStats(){
  const total=parseInt(localStorage.getItem("total"));
  const aceptaron=parseInt(localStorage.getItem("aceptaron"));
  const rechazaron=parseInt(localStorage.getItem("rechazaron"));

  document.getElementById("total").innerText=total;
  document.getElementById("aceptaron").innerText=aceptaron;
  document.getElementById("rechazaron").innerText=rechazaron;

  const porcentaje= total>0 ? Math.round((aceptaron/total)*100) : 0;
  document.getElementById("porcentaje").innerText=porcentaje;
}

function aceptar(){
  localStorage.setItem("total",parseInt(localStorage.getItem("total"))+1);
  localStorage.setItem("aceptaron",parseInt(localStorage.getItem("aceptaron"))+1);
  document.getElementById("mensaje").innerText=
    "üíµ Aceptaste el mill√≥n. El destino ya no tiene marcha atr√°s‚Ä¶";
  document.getElementById("decision").style.display="none";
  actualizarStats();
}

function rechazar(){
  localStorage.setItem("total",parseInt(localStorage.getItem("total"))+1);
  localStorage.setItem("rechazaron",parseInt(localStorage.getItem("rechazaron"))+1);
  document.getElementById("mensaje").innerText=
    "‚ùå Rechazaste el mill√≥n. Elegiste seguridad sobre dinero.";
  document.getElementById("decision").style.display="none";
  actualizarStats();
}

function reiniciar() {
      if (confirm("¬øSeguro que deseas reiniciar el conteo?")) {
        total = 0;
        aceptaron = 0;
        rechazaron = 0;

        localStorage.setItem("total", 0);
        localStorage.setItem("aceptaron", 0);
        localStorage.setItem("rechazaron", 0);

        document.getElementById("mensaje").textContent = "";
        actualizarPantalla();
      }

window.onload=iniciarContador;
</script>

</body>
</html>

